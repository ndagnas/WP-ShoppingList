//*******************************************************************************************************************************
// DEBUT DU FICHIER
//*******************************************************************************************************************************

//*******************************************************************************************************************************
// Nom           : BddArticles.cs
// Auteur        : Nicolas Dagnas
// Description   : Implémentation des objets du namespace ShoppingList.Data
// Créé le       : 27/10/2013
// Modifié le    : 27/10/2013
//*******************************************************************************************************************************

//-------------------------------------------------------------------------------------------------------------------------------
#region Using directives
//-------------------------------------------------------------------------------------------------------------------------------
using System;
using System.IO;
using System.Windows;
using System.Data.Linq;
using System.Windows.Resources;
using System.Data.Linq.Mapping;
using System.IO.IsolatedStorage;
//-------------------------------------------------------------------------------------------------------------------------------
#endregion
//-------------------------------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------------------------------------
#pragma warning disable 1591
//-------------------------------------------------------------------------------------------------------------------------------

//*******************************************************************************************************************************
// Début du bloc "ShoppingList.Data"
//*******************************************************************************************************************************
namespace ShoppingList.Data
	{

	//  ####   ####   ####           ###   ####   #####  #   ###   #      #####   ####
	//  #   #  #   #  #   #         #   #  #   #    #    #  #   #  #      #      #    
	//  ####   #   #  #   #  #####  #####  ####     #    #  #      #      ###     ### 
	//  #   #  #   #  #   #         #   #  #   #    #    #  #   #  #      #          #
	//  ####   ####   ####          #   #  #   #    #    #   ###   #####  #####  #### 

	//***************************************************************************************************************************
	// Classe BddArticles
	//***************************************************************************************************************************
	#region // Déclaration et Implémentation de l'Objet
	//---------------------------------------------------------------------------------------------------------------------------
	/// <summary>
	/// Fournit l'accés à la base de données <b>BddArticles</b>.
	/// </summary>
	//---------------------------------------------------------------------------------------------------------------------------
	public partial class BddArticles : DataContext
		{
		//-----------------------------------------------------------------------------------------------------------------------
		// Section des Attributs
		//-----------------------------------------------------------------------------------------------------------------------
		private static string  FileName    = "BddArticles.sdf";
		private static Version FileVersion = new Version ( 1, 0 );
		//-----------------------------------------------------------------------------------------------------------------------

		//***********************************************************************************************************************
		/// <summary>
		/// Se connecte à la base de données <b>BddArticles</b>.
		/// </summary>
		//-----------------------------------------------------------------------------------------------------------------------
		public static BddArticles Open ()
			{
			//-------------------------------------------------------------------------------------------------------------------
			#region // Implémentation de la Procédure
			//-------------------------------------------------------------------------------------------------------------------
			
			//-------------------------------------------------------------------------------------------------------------------
			string Prefix = Path.GetFileNameWithoutExtension ( FileName );

			string LocalFileName = string.Format ( "{0}.{1}-{2}.sdf", Prefix, 
			                                                FileVersion.Major, FileVersion.Minor );
			//-------------------------------------------------------------------------------------------------------------------

			//-------------------------------------------------------------------------------------------------------------------
			using ( var isolatedStorageFile = IsolatedStorageFile.GetUserStoreForApplication () )
				{
				//---------------------------------------------------------------------------------------------------------------
				if ( ! isolatedStorageFile.FileExists ( LocalFileName ) )
					{
					//-----------------------------------------------------------------------------------------------------------
					StreamResourceInfo BddRess = Application.GetResourceStream 
					                                    ( new Uri ( FileName, UriKind.Relative ) );
					//-----------------------------------------------------------------------------------------------------------

					//-----------------------------------------------------------------------------------------------------------
					using ( var file = isolatedStorageFile.CreateFile ( LocalFileName ) )
						{
						//-------------------------------------------------------------------------------------------------------
						var length = BddRess.Stream.Length;
						var buffer = new byte[1024];
						var readCount = 0;

						using ( var binaryReader = new BinaryReader ( BddRess.Stream ) )
							{
							while ( readCount < length )
								{
								int actual = binaryReader.Read ( buffer, 0, buffer.Length );

								readCount += actual;

								file.Write ( buffer, 0, actual );
								}
							}
						//-------------------------------------------------------------------------------------------------------
						}
					//-----------------------------------------------------------------------------------------------------------
					}
				//---------------------------------------------------------------------------------------------------------------
				}
			//-------------------------------------------------------------------------------------------------------------------

			//-------------------------------------------------------------------------------------------------------------------
			return new BddArticles ( "Data Source = 'isostore:/" + LocalFileName + "';" );
			//-------------------------------------------------------------------------------------------------------------------

			//-------------------------------------------------------------------------------------------------------------------
			#endregion
			//-------------------------------------------------------------------------------------------------------------------
			}
		//***********************************************************************************************************************

		//***********************************************************************************************************************
		/// <summary>
		/// Initialise une nouvelle instance de l'objet <b>BddArticles</b>.
		/// </summary>
		/// <param name="Connection">Chaine de connexion à la base.</param>
		//-----------------------------------------------------------------------------------------------------------------------
		private BddArticles ( string Connection ) : 
		                   base ( Connection, new AttributeMappingSource() ) { this.OnCreated (); }
		//***********************************************************************************************************************

		//***********************************************************************************************************************
		#region // Définition des méthodes d'extensions
		//-----------------------------------------------------------------------------------------------------------------------

		//-----------------------------------------------------------------------------------------------------------------------
		partial void OnCreated      (                   );
		//-----------------------------------------------------------------------------------------------------------------------
		partial void InsertArticle  ( Article  Instance );
		partial void UpdateArticle  ( Article  Instance );
		partial void DeleteArticle  ( Article  Instance );
		//-----------------------------------------------------------------------------------------------------------------------
		partial void InsertShopping ( Shopping Instance );
		partial void UpdateShopping ( Shopping Instance );
		partial void DeleteShopping ( Shopping Instance );
		//-----------------------------------------------------------------------------------------------------------------------
		partial void InsertPurchase ( Purchase Instance );
		partial void UpdatePurchase ( Purchase Instance );
		partial void DeletePurchase ( Purchase Instance );
		//-----------------------------------------------------------------------------------------------------------------------

		//-----------------------------------------------------------------------------------------------------------------------
		#endregion
		//***********************************************************************************************************************

		//***********************************************************************************************************************
		/// <summary>
		/// Accède à la table <b>Article</b>.
		/// </summary>
		//-----------------------------------------------------------------------------------------------------------------------
		public Table<Article> Article { get { return this.GetTable<Article>(); } }
		//***********************************************************************************************************************

		//***********************************************************************************************************************
		/// <summary>
		/// Accède à la table <b>Shopping</b>.
		/// </summary>
		//-----------------------------------------------------------------------------------------------------------------------
		public Table<Shopping> Shopping { get { return this.GetTable<Shopping>(); } }
		//***********************************************************************************************************************

		//***********************************************************************************************************************
		/// <summary>
		/// Accède à la table <b>Purchase</b>.
		/// </summary>
		//-----------------------------------------------------------------------------------------------------------------------
		public Table<Purchase> Purchase { get { return this.GetTable<Purchase>(); } }
		//***********************************************************************************************************************
		}
	//---------------------------------------------------------------------------------------------------------------------------
	#endregion
	//***************************************************************************************************************************

	} // Fin du namespace "ShoppingList.Data"
//*******************************************************************************************************************************

//-------------------------------------------------------------------------------------------------------------------------------
#pragma warning restore 1591
//-------------------------------------------------------------------------------------------------------------------------------

//*******************************************************************************************************************************
// FIN DU FICHIER
//*******************************************************************************************************************************
